test_windows_x64:
  stage: test
  tags:
    - windows x64
    - scilab
  variables:
      GIT_CLEAN_FLAGS: none
  needs:
    - build_windows_x64_branch
  script:
    - if not exist "%SCI_VERSION_STRING%\" .\%SCI_VERSION_STRING%.exe /SUPPRESSMSGBOXES /SILENT /SP- /DIR=%SCI_VERSION_STRING%
    - .\%SCI_VERSION_STRING%\bin\scilab -nwni -quit -e 'test_run("'$TEST'",[],[],"'$TEST.xml'")'
  artifacts:
    when: always
    paths:
      - $TEST.xml
    reports:
      junit: $TEST.xml
  parallel:
    matrix:
      - TEST:
        - ast
        - core
        - fileio
        - functions
        - jvm
        - time

test_linux_x86_64:
  stage: test
  tags:
    - linux x86_64
    - scilab
  variables:
      GIT_CLEAN_FLAGS: none
  needs:
    - build_linux_x86_64_branch
  script:
    - env
    - if [ ! -d "$SCI_VERSION_STRING" ]; then tar -xzf $SCI_VERSION_STRING.*.tar.gz; fi
    - $SCI_VERSION_STRING/bin/scilab -nwni -quit -e 'test_run("'$TEST'",[],[],"'$TEST.xml'")'
  artifacts:
    when: always
    paths:
      - $TEST.xml
    reports:
      junit: $TEST.xml
  parallel:
    matrix:
      - TEST:
        - ast
        - core
        - fileio
        - functions
        - jvm
        - time
