x64_windows_test_branch:
  stage: test
  tags:
    - x64_windows
    - scilab
  variables:
      # enforce download and install on each test
      GIT_CLEAN_FLAGS: -fxd scilab-*
  needs:
    # build artifacts will be download by the script only if needed
    - job: x64_windows_build_branch
      artifacts: false
    # get env information used to build scilab
    - job: x64_windows_set_branch_env
      artifacts: true
  script: call .gitlab-ci\test.bat
#  rules:
#    - changes:
#      - scilab/modules/$TESTS/**/*
  artifacts:
    when: always
    paths:
      - $TEST.xml
    reports:
      junit: $TEST.xml
  parallel:
    matrix:
      - TEST:
        - ast
        - core
        - fileio
        - functions
        - jvm
        - time

x86_64-linux-gnu_test_branch:
  stage: test
  tags:
    - x86_64-linux-gnu
    - scilab
  variables:
      # enforce download and install on each test
      GIT_CLEAN_FLAGS: -fxd scilab-*
  needs:
    # build artifacts will be download by the script only if needed
    - job: x86_64-linux-gnu_build_branch
      artifacts: false
    # get env information used to build scilab
    - job: x86_64-linux-gnu_set_branch_env
      artifacts: true
  script: bash -e -x .gitlab-ci/test.sh
#  rules:
#    - changes:
#      - scilab/modules/$TESTS/**/*
  artifacts:
    when: always
    paths:
      - $TEST.xml
    reports:
      junit: $TEST.xml
  parallel:
    matrix:
      - TEST:
        - ast
        - core
        - fileio
        - functions
        - jvm
        - time
