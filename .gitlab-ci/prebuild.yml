# get prerequirements from svn
prebuild windows x64:
  stage: prebuild
  tags:
    - windows
  cache:
    key: prerequirements-windows-x64
    paths:
      - scilab/Visual-Studio-settings/
      - scilab/bin/
      - scilab/java/
      - scilab/libs/
      - scilab/modules/
      - scilab/thirdparty/
      - scilab/tools/
    policy: push
  script:
    - svn checkout --force --username anonymous --password Scilab svn://svn.scilab.org/scilab/trunk/Dev-Tools/SE/Prerequirements/Windows_x64/ scilab
  when: manual

# get prerequirements from svn
prebuild linux x86_64:
  stage: prebuild
  tags:
    - linux
  cache:
    key: prerequirements-linux-x86_64
    paths:
      - scilab/java/
      - scilab/lib/
      - scilab/modules/
      - scilab/thirdparty/
      - scilab/usr/
    policy: push
  script:
    - svn checkout --force --username anonymous --password Scilab svn://svn.scilab.org/scilab/trunk/Dev-Tools/SE/Prerequirements/linux_x64/ scilab
  when: manual


# create docker images for builders 
create docker images:
  stage: prebuild
  image: docker
  script:
    - docker login -u $CI_REGISTRY_USER -p $CI_REGISTRY_PASSWORD $CI_REGISTRY
    - docker build -t $CI_REGISTRY/scilab/scilab:builder_linux - < /.gitlab-ci/Dockerfile.linux
    - docker push $CI_REGISTRY/scilab/scilab:builder_linux
# Docker windows not supported yet
#  - docker build -t $CI_REGISTRY/scilab/scilab:builder_windows - < /.gitlab-ci/Dockerfile.windows
#  - docker push $CI_REGISTRY/scilab/scilab:builder_windows
  only:
    changes:
      - /.gitlab-ci.yml
      - /.gitlab-ci/Dockerfile*
