# build scilab using a windows runner
build windows x64:
  stage: build
  needs: ["cleanup old windows builds"]
  tags:
    - windows x64
    - scilab
  cache:
    key: prerequirements-windows-x64
    policy: pull
  variables:
      GIT_CLEAN_FLAGS: none
  script: call .gitlab-ci\bld.bat
  artifacts:
    paths:
      - log*.txt
      - scilab\tools\innosetup\Scilab.iss
      - scilab-branch-${CI_COMMIT_BRANCH}-*.exe
    when: always


# build scilab using a linux runner
build linux x86_64:
  stage: build
  needs: ["cleanup old linux builds"]
  tags:
    - linux x86_64
    - scilab
  cache:
    key: prerequirements-linux-x86_64
    policy: pull
  variables:
      GIT_CLEAN_FLAGS: none
  script: bash -x -e .gitlab-ci/build.sh
  artifacts:
    paths:
      - log*.txt
      - scilab-branch-${CI_COMMIT_BRANCH}-*.tar.gz
    when: always


# build scilab using the docker image
build docker:
  stage: build
  image: $CI_REGISTRY/scilab/scilab:builder_linux
  tags:
    - docker
    - scilab
  cache:
    key: prerequirements-linux-x86_64
    policy: pull
  variables:
      GIT_CLEAN_FLAGS: none
  when: manual
  script: bash -x -e .gitlab-ci/build.sh
  artifacts:
    paths:
      - log*.txt
      - scilab-branch-${CI_COMMIT_BRANCH}-*.tar.gz
