# build scilab using a windows runner
.x64_windows_build:
  stage: build
  needs: 
    - x64_windows_cleanup_builds
  tags:
    - x64_windows
    - scilab
  variables:
      GIT_CLEAN_FLAGS: none
  script: call .gitlab-ci\build.bat
  artifacts:
    paths:
      - log*.txt
      - $SCI_VERSION_STRING_$ARCH.exe
    when: always
# build an intermediate version
x64_windows_build_branch:
  extends: .x64_windows_build
  needs:
    - x64_windows_set_branch_env
    - contains_changes_modification
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_REF_PROTECTED
# build a release version
x64_windows_build_release:
  extends: .x64_windows_build
  needs:
    - x64_windows_set_release_env
    - prepare_release_files
  rules:
    - if: $CI_COMMIT_TAG


# build scilab using a linux runner
.x86_64-linux-gnu_build:
  stage: build
  needs:
    - x86_64-linux-gnu_cleanup_builds
  tags:
    - x86_64-linux-gnu
    - scilab
  variables:
      GIT_CLEAN_FLAGS: none
  script: bash -x -e .gitlab-ci/build.sh
  artifacts:
    paths:
      - log*.txt
      - $SCI_VERSION_STRING.bin.$ARCH.tar.gz"
    when: always
# build an intermediate version
x86_64-linux-gnu_build_branch:
  extends: .x86_64-linux-gnu_build
  needs:
    - x86_64-linux-gnu_set_branch_env
    - contains_changes_modification
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
    - if: $CI_COMMIT_REF_PROTECTED
# build a release
x86_64-linux-gnu_build_release:
  extends: .x86_64-linux-gnu_build
  needs:
    - x86_64-linux-gnu_set_release_env
    - prepare_release_files
  rules:
    - if: $CI_COMMIT_TAG
