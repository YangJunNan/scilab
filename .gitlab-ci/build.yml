build windows x64:
  stage: build
  tags:
    - windows x64
    - visual studio 2017
    - intel oneAPI
    - openjdk 8
    - innosetup 6
  cache:
    key: prerequirements-windows-x64
    policy: pull
  script:
    - cd scilab
    - svn update
    - 'C:\Program Files (x86)\Microsoft Visual Studio 14.0\VC\vcvarsall.bat x64'
    - devenv Scilab.sln /Build Release /Project WScilex /ProjectConfig 'Release|x64'

build linux x86_64:
  stage: build
  tags:
    - linux x86_64
    - g++
    - gfortran
    - openjdk 8
  cache:
    key: prerequirements-linux-x86_64
    policy: pull
  script:
    - cd scilab
    # likely cached
    - svn update
    - ./configure --prefix=''
    - make -j
    - make install DESTDIR=scilab-branch-${CI_COMMIT_REF_NAME}-${CI_COMMIT_TIMESTAMP}
  artifacts:
    paths:
      - scilab-branch-${CI_COMMIT_REF_NAME}-${CI_COMMIT_TIMESTAMP}

build docker:
  stage: build
  image: $CI_REGISTRY/scilab/scilab:builder_linux
  
  cache:
    key: prerequirements-linux-x86_64
    policy: pull
  script:
    - cd scilab
    # likely cached
    - svn update
    - ./configure --prefix=''
    - make -j
    - make install DESTDIR=scilab-branch-${CI_COMMIT_REF_NAME}-${CI_COMMIT_TIMESTAMP}
  artifacts:
    paths:
      - scilab-branch-${CI_COMMIT_REF_NAME}-${CI_COMMIT_TIMESTAMP}
